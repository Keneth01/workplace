<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Job Count</title>
<style>
  * { margin:0; padding:0; box-sizing:border-box; }
  body {
    font-family: monospace;
    background: #111;
    color: #ccc;
    height: 100vh;
    cursor: pointer;
    display: flex;
    justify-content: center;
    align-items: flex-start;
    padding-top: 20px;
  }

  .container {
    background: #000;
    border-radius: 6px;
    padding: 10px;
    width: 280px;
    display: none;
    opacity: 0.7;
    transition: opacity 0.2s;
    border: 1px solid #444;
  }

  h2 { font-weight: normal; text-align: center; margin-bottom: 6px; font-size:16px; }

  input {
    width: 100%;
    margin: 3px 0;
    padding: 5px;
    font-size: 13px;
    background: #111;
    border: 1px solid #333;
    border-radius: 4px;
    color: #ccc;
  }
  input::placeholder { color: #555; }

  .result-box {
    margin-top:6px;
    padding:6px;
    background:#111;
    border-radius:4px;
    font-size:13px;
    cursor:pointer;
    white-space: pre-line;
  }
  .result-box:hover { background:#222; }

  .timer { font-size:12px; text-align:center; margin-top:4px; color:#888; }
</style>
</head>
<body>

<div class="container" id="container">
  <h2>JOB COUNT</h2>
  <input type="text" id="break1" placeholder="1st Break" oninput="saveAndCalculate()">
  <input type="text" id="lunch" placeholder="Lunch" oninput="saveAndCalculate()">
  <input type="text" id="break2" placeholder="2nd Break" oninput="saveAndCalculate()">
  <input type="text" id="eos" placeholder="EOS" oninput="saveAndCalculate()">
  <input type="text" id="station" placeholder="Station#" oninput="saveAndCalculate()">
  <div class="result-box" id="resultBox" onclick="copyToClipboard()">Click to Copy</div>
  <div id="timerDisplay" class="timer">Timer: 0s</div>
</div>

<script>
const fields = ['break1','lunch','break2','eos','station'];
const container = document.getElementById('container');
const resultBox = document.getElementById('resultBox');
const timerDisplay = document.getElementById('timerDisplay');
let closeTimer, startTime, timerInterval;

document.body.addEventListener('click', e => {
  if(container.style.display === 'none') showCalculator();
  else if(!container.contains(e.target)) closeCalculator();
});

function showCalculator() {
  container.style.display = 'block';
  resetCloseTimer();
  startTime = Date.now();
  startTimer();
}

function closeCalculator() {
  container.style.display = 'none';
  clearInterval(timerInterval);
}

function startTimer() {
  timerInterval = setInterval(() => {
    const elapsed = Math.floor((Date.now() - startTime)/1000);
    timerDisplay.textContent = `Timer: ${elapsed}s`;
  }, 1000);
}

window.addEventListener('DOMContentLoaded', () => {
  fields.forEach(f => {
    const v = localStorage.getItem(f);
    if(v) document.getElementById(f).value = v;
  });
  calculate();
});

function saveAndCalculate() {
  const anyFilled = fields.some(id => document.getElementById(id).value.trim());
  fields.forEach(id => {
    const val = document.getElementById(id).value;
    if(anyFilled) localStorage.setItem(id,val);
    else localStorage.removeItem(id);
  });
  calculate();
}

function calculate() {
  const vals = fields.map(id => document.getElementById(id).value.trim());
  const [b1,l,b2,e,station] = vals;

  const numB1 = parseInt(b1);
  const numL  = parseInt(l);
  const numB2 = parseInt(b2);
  const numE  = parseInt(e);

  const lines = [];

  // Always show EOD Report if EOS has any value (number or text)
  if(e){
    const today = new Date();
    const date = `${String(today.getMonth()+1).padStart(2,'0')}/${String(today.getDate()).padStart(2,'0')}/${today.getFullYear()}`;
    lines.push(`EOD Report ${date}`,'');
  }

  lines.push("Jobcount");

  if(b1) lines.push(`1st Break: ${isNaN(numB1) ? b1 : numB1}`);
  if(l)  lines.push(`Lunch: ${(!isNaN(numL) && !isNaN(numB1)) ? (numL - numB1) : l}`);
  if(b2) lines.push(`2nd Break: ${(!isNaN(numB2) && !isNaN(numL)) ? (numB2 - numL) : b2}`);
  if(e)  lines.push(`EOS: ${(!isNaN(numE) && !isNaN(numB2)) ? (numE - numB2) : e}`);

  // Always show Total if EOS has any value
  if(e){
    lines.push(`Total: ${isNaN(numE) ? e : numE}`);
    if(station) lines.push('',`Station#: ${station}`);
    lines.push("On time tagging, No Overbreak and Lunch","Complete assets: No Damage No Privacy screen");
  }

  resultBox.textContent = lines.join("\n");
}

function copyToClipboard() {
  const ta = document.createElement('textarea');
  ta.value = resultBox.textContent;
  document.body.appendChild(ta);
  ta.select();
  document.execCommand('copy');
  document.body.removeChild(ta);
  alert("Copied to clipboard!");
  closeCalculator();
}

function resetCloseTimer() {
  clearTimeout(closeTimer);
  closeTimer = setTimeout(closeCalculator,10000);
}

container.addEventListener('mouseenter',()=>container.style.opacity=1);
container.addEventListener('mouseleave',()=>container.style.opacity=0.7);
</script>

</body>
</html>
